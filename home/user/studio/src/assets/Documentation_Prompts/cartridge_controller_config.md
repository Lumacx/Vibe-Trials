# Cartridge Controller Configuration in Next.js Project

This document summarizes the Web3 integration files that were migrated into the Next.js project structure and explains how the Cartridge Controller is configured and used within this environment.

## Migrated Files and Their Purpose

Several files related to the Dojo and Starknet integration, originally part of a separate client application, have been migrated into dedicated directories within the `src` folder of the Next.js project.

### `/home/user/studio/src/dojo`

This directory serves as the central location for core Dojo and Starknet related files.

*   **`starknet-provider.tsx`**: This file provides the `StarknetProvider` component from `@starknet-react/core`. It sets up the necessary context for using Starknet-related hooks throughout the application. It is configured with the appropriate chains (Sepolia or Mainnet based on environment variables), the `cartridgeConnector`, and a JSON RPC provider. It is marked as a client component (`"use client"`) to ensure it runs in the browser environment.
*   **`useStarknetConnect.tsx`**: This custom React hook provides a convenient way to manage Starknet wallet connection state and functionality within client components. It leverages hooks from `@starknet-react/core` (`useConnect`, `useDisconnect`, `useAccount`) to handle connecting, disconnecting, and retrieving the connected account's status and address. This hook is used in client components (like the homepage) to display wallet connection information and trigger connection actions.
*   **`dojoConfig.ts`**: This file defines the configuration object required to initialize the Dojo SDK. It includes essential details such as the Torii URL, the Dojo world contract address, and the master account details. These values are sourced from environment variables prefixed with `NEXT_PUBLIC_`, making them accessible in both server and client environments within the Next.js application.
*   **`bindings.ts`**: This file contains TypeScript type definitions for the Dojo world's models and events. These types are crucial for ensuring type safety when interacting with data fetched from the Dojo world or when defining data structures related to the game state.
*   **`contracts.gen.ts`**: This file is likely generated by Dojo's build process and contains TypeScript code for interacting with the deployed Dojo smart contracts. It provides functions to build calldata and potentially execute transactions for various game actions defined in the contracts.

### `/home/user/studio/src/dojo/config`

This subdirectory within `src/dojo` specifically holds configuration files related to the Dojo and Starknet setup.

*   **`cartridgeConnector.tsx`**: This file defines and configures the `ControllerConnector` from `@cartridge/connector`. This connector is essential for allowing users to connect their Cartridge wallet to the application. It is configured with the appropriate RPC URL, default chain ID, and contract policies (defining which contracts and methods the connector is allowed to interact with). It is also marked as a client component.
*   **`manifest.ts`**: This file manages the different deployment manifests for the Dojo contracts (e.g., development, Sepolia, Mainnet). It selects the appropriate manifest based on the `NEXT_PUBLIC_DEPLOY_TYPE` environment variable, providing the necessary contract addresses and ABIs for the application to interact with the deployed contracts.
*   **`manifest_sepolia.json`**: This JSON file contains the deployment manifest for the Dojo contracts on the Sepolia testnet. It includes contract addresses, ABIs, and other deployment-specific information.

### `/home/user/studio/src/dojo/contracts`

This directory likely contains the compiled contract artifacts or other contract-specific files.

*   **`target/dev/` (and files within)**: This subdirectory typically holds the compiled contract class JSON files (e.g., `full_starter_react_game.contract_class.json`). These compiled artifacts are used by the Dojo SDK and other tools to understand the structure and functions of the deployed contracts.

## Cartridge Controller Configuration and Usage

The Cartridge Controller (`@cartridge/controller`) is configured and used within this Next.js project primarily through the `cartridgeConnector.tsx` file.

1.  **Configuration in `cartridgeConnector.tsx`**: The `cartridgeConnector.tsx` file instantiates the `ControllerConnector` class, passing in a `ControllerOptions` object. This options object includes:
    *   **`chains`**: Specifies the blockchain networks the connector can interact with, configured with RPC URLs based on the `NEXT_PUBLIC_DEPLOY_TYPE` environment variable.
    *   **`defaultChainId`**: Sets the default chain the connector should use, also determined by the `NEXT_PUBLIC_DEPLOY_TYPE`.
    *   **`policies`**: Defines a set of rules that dictate which smart contracts and their methods the Cartridge Controller is allowed to interact with. This provides a layer of security and control.
    *   **`namespace` and `slot`**: These parameters are specific to Cartridge's infrastructure and help identify the game or application the connector is being used for.

2.  **Integration with `@starknet-react/core`**: The configured `cartridgeConnector` instance is then passed to the `connectors` prop of the `StarknetConfig` component within `starknet-provider.tsx`. This makes the Cartridge connector available to the `@starknet-react/core` hooks.

3.  **Usage via `useStarknetConnect` Hook**: Client components in the Next.js application (like `src/app/page.tsx`) use the custom `useStarknetConnect` hook (which in turn uses `@starknet-react/core` hooks like `useConnect`). When a user interacts with the wallet connection UI (e.g., clicking a "Connect Wallet" button), the `handleConnect` function from `useStarknetConnect` is called. This function utilizes the `connect` function provided by `@starknet-react/core`, which internally uses the configured `cartridgeConnector` to initiate the wallet connection process via the Cartridge Controller.

4.  **Authentication and Optional Score Saving**: The connected wallet address, obtained through the `useAccount` hook (used within `useStarknetConnect`), serves as the user's unique identifier for authentication within the Web2 game logic. For users who wish to save scores on the blockchain, the application can then use the connected account to sign transactions that interact with the appropriate Dojo smart contracts (as defined by the `policies` in the Cartridge Controller configuration), leveraging the functionality provided by the Dojo SDK and the `contracts.gen.ts` file.

By organizing these files and using the `StarknetProvider` and `useStarknetConnect` hook, the Next.js application effectively integrates the Cartridge Controller and the Starknet wallet connection process, enabling Web3 features for authentication and optional on-chain score saving within the Web2 game environment.